<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 8 Data Wrangling | An Introduction to R at Met Council</title>
  <meta name="description" content="These are materials intended for a four hour introduction to reproducible data analysis in R." />
  <meta name="generator" content="bookdown 0.12 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 8 Data Wrangling | An Introduction to R at Met Council" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="These are materials intended for a four hour introduction to reproducible data analysis in R." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 8 Data Wrangling | An Introduction to R at Met Council" />
  
  <meta name="twitter:description" content="These are materials intended for a four hour introduction to reproducible data analysis in R." />
  

<meta name="author" content="Katie Jolly" />


<meta name="date" content="2019-08-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="visualization.html">
<link rel="next" href="visualization-revisited.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Introduction to R at Met Council</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome!</a></li>
<li class="chapter" data-level="2" data-path="setup.html"><a href="setup.html"><i class="fa fa-check"></i><b>2</b> Installing R and RStudio</a><ul>
<li class="chapter" data-level="2.1" data-path="setup.html"><a href="setup.html#rstudio-cloud"><i class="fa fa-check"></i><b>2.1</b> RStudio Cloud</a></li>
<li class="chapter" data-level="2.2" data-path="setup.html"><a href="setup.html#rstudio-desktop"><i class="fa fa-check"></i><b>2.2</b> RStudio Desktop</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="r-projects.html"><a href="r-projects.html"><i class="fa fa-check"></i><b>3</b> R Projects</a><ul>
<li class="chapter" data-level="3.1" data-path="r-projects.html"><a href="r-projects.html#set-up-your-project-cloud"><i class="fa fa-check"></i><b>3.1</b> Set up your project: Cloud</a></li>
<li class="chapter" data-level="3.2" data-path="r-projects.html"><a href="r-projects.html#set-up-your-project-desktop"><i class="fa fa-check"></i><b>3.2</b> Set up your project: Desktop</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="writing-r-code.html"><a href="writing-r-code.html"><i class="fa fa-check"></i><b>4</b> Writing R code</a><ul>
<li class="chapter" data-level="4.1" data-path="writing-r-code.html"><a href="writing-r-code.html#the-console"><i class="fa fa-check"></i><b>4.1</b> The console</a><ul>
<li class="chapter" data-level="4.1.1" data-path="writing-r-code.html"><a href="writing-r-code.html#try-it-out"><i class="fa fa-check"></i><b>4.1.1</b> Try it out</a></li>
<li class="chapter" data-level="4.1.2" data-path="writing-r-code.html"><a href="writing-r-code.html#r-objects"><i class="fa fa-check"></i><b>4.1.2</b> R objects</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="writing-r-code.html"><a href="writing-r-code.html#r-scripts"><i class="fa fa-check"></i><b>4.2</b> R scripts</a><ul>
<li class="chapter" data-level="4.2.1" data-path="writing-r-code.html"><a href="writing-r-code.html#comments"><i class="fa fa-check"></i><b>4.2.1</b> Comments</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="writing-r-code.html"><a href="writing-r-code.html#r-markdown"><i class="fa fa-check"></i><b>4.3</b> R markdown</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>5</b> Packages</a></li>
<li class="chapter" data-level="6" data-path="reading-in-data.html"><a href="reading-in-data.html"><i class="fa fa-check"></i><b>6</b> Reading in Data</a><ul>
<li class="chapter" data-level="6.1" data-path="reading-in-data.html"><a href="reading-in-data.html#data-packages"><i class="fa fa-check"></i><b>6.1</b> Data packages</a><ul>
<li class="chapter" data-level="6.1.1" data-path="reading-in-data.html"><a href="reading-in-data.html#try-it-out-1"><i class="fa fa-check"></i><b>6.1.1</b> Try it out</a></li>
<li class="chapter" data-level="6.1.2" data-path="reading-in-data.html"><a href="reading-in-data.html#practice"><i class="fa fa-check"></i><b>6.1.2</b> Practice</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="visualization.html"><a href="visualization.html"><i class="fa fa-check"></i><b>7</b> Visualization</a><ul>
<li class="chapter" data-level="7.1" data-path="visualization.html"><a href="visualization.html#base-r-plotting"><i class="fa fa-check"></i><b>7.1</b> Base R plotting</a></li>
<li class="chapter" data-level="7.2" data-path="visualization.html"><a href="visualization.html#ggplot2"><i class="fa fa-check"></i><b>7.2</b> ggplot2</a><ul>
<li class="chapter" data-level="7.2.1" data-path="visualization.html"><a href="visualization.html#categorical-data"><i class="fa fa-check"></i><b>7.2.1</b> Categorical data</a></li>
<li class="chapter" data-level="7.2.2" data-path="visualization.html"><a href="visualization.html#try-it-out-2"><i class="fa fa-check"></i><b>7.2.2</b> Try it out</a></li>
<li class="chapter" data-level="7.2.3" data-path="visualization.html"><a href="visualization.html#quantitative-data"><i class="fa fa-check"></i><b>7.2.3</b> Quantitative data</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="visualization.html"><a href="visualization.html#practice-1"><i class="fa fa-check"></i><b>7.3</b> Practice</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="data-wrangling.html"><a href="data-wrangling.html"><i class="fa fa-check"></i><b>8</b> Data Wrangling</a><ul>
<li class="chapter" data-level="8.1" data-path="data-wrangling.html"><a href="data-wrangling.html#row-verbs"><i class="fa fa-check"></i><b>8.1</b> Row verbs</a><ul>
<li class="chapter" data-level="8.1.1" data-path="data-wrangling.html"><a href="data-wrangling.html#filter"><i class="fa fa-check"></i><b>8.1.1</b> Filter</a></li>
<li class="chapter" data-level="8.1.2" data-path="data-wrangling.html"><a href="data-wrangling.html#arrange"><i class="fa fa-check"></i><b>8.1.2</b> Arrange</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="data-wrangling.html"><a href="data-wrangling.html#practice-2"><i class="fa fa-check"></i><b>8.2</b> Practice</a></li>
<li class="chapter" data-level="8.3" data-path="data-wrangling.html"><a href="data-wrangling.html#column-verbs"><i class="fa fa-check"></i><b>8.3</b> Column verbs</a><ul>
<li class="chapter" data-level="8.3.1" data-path="data-wrangling.html"><a href="data-wrangling.html#mutate"><i class="fa fa-check"></i><b>8.3.1</b> Mutate</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="data-wrangling.html"><a href="data-wrangling.html#practice-3"><i class="fa fa-check"></i><b>8.4</b> Practice</a><ul>
<li class="chapter" data-level="8.4.1" data-path="data-wrangling.html"><a href="data-wrangling.html#select"><i class="fa fa-check"></i><b>8.4.1</b> Select</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="data-wrangling.html"><a href="data-wrangling.html#aggregate-verbs"><i class="fa fa-check"></i><b>8.5</b> Aggregate verbs</a><ul>
<li class="chapter" data-level="8.5.1" data-path="data-wrangling.html"><a href="data-wrangling.html#section"><i class="fa fa-check"></i><b>8.5.1</b> <code>%&gt;%</code></a></li>
<li class="chapter" data-level="8.5.2" data-path="data-wrangling.html"><a href="data-wrangling.html#group_by-summarise"><i class="fa fa-check"></i><b>8.5.2</b> group_by &amp; summarise</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="data-wrangling.html"><a href="data-wrangling.html#practice-4"><i class="fa fa-check"></i><b>8.6</b> Practice</a></li>
<li class="chapter" data-level="8.7" data-path="data-wrangling.html"><a href="data-wrangling.html#reshaping-verbs"><i class="fa fa-check"></i><b>8.7</b> Reshaping verbs</a><ul>
<li class="chapter" data-level="8.7.1" data-path="data-wrangling.html"><a href="data-wrangling.html#spread"><i class="fa fa-check"></i><b>8.7.1</b> Spread</a></li>
<li class="chapter" data-level="8.7.2" data-path="data-wrangling.html"><a href="data-wrangling.html#gather"><i class="fa fa-check"></i><b>8.7.2</b> Gather</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="data-wrangling.html"><a href="data-wrangling.html#practice-5"><i class="fa fa-check"></i><b>8.8</b> Practice</a></li>
<li class="chapter" data-level="8.9" data-path="data-wrangling.html"><a href="data-wrangling.html#joins"><i class="fa fa-check"></i><b>8.9</b> Joins</a></li>
<li class="chapter" data-level="8.10" data-path="data-wrangling.html"><a href="data-wrangling.html#practice-6"><i class="fa fa-check"></i><b>8.10</b> Practice</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="visualization-revisited.html"><a href="visualization-revisited.html"><i class="fa fa-check"></i><b>9</b> Visualization, revisited</a><ul>
<li class="chapter" data-level="9.1" data-path="visualization-revisited.html"><a href="visualization-revisited.html#facets"><i class="fa fa-check"></i><b>9.1</b> Facets</a></li>
<li class="chapter" data-level="9.2" data-path="visualization-revisited.html"><a href="visualization-revisited.html#multivariate-visualization"><i class="fa fa-check"></i><b>9.2</b> Multivariate visualization</a></li>
<li class="chapter" data-level="9.3" data-path="visualization-revisited.html"><a href="visualization-revisited.html#practice-7"><i class="fa fa-check"></i><b>9.3</b> Practice</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="reading-in-data-revisited.html"><a href="reading-in-data-revisited.html"><i class="fa fa-check"></i><b>10</b> Reading in data, revisited</a></li>
<li class="chapter" data-level="11" data-path="more-resources.html"><a href="more-resources.html"><i class="fa fa-check"></i><b>11</b> More resources</a><ul>
<li class="chapter" data-level="11.1" data-path="more-resources.html"><a href="more-resources.html#projects-using-this-data"><i class="fa fa-check"></i><b>11.1</b> Projects using this data</a></li>
<li class="chapter" data-level="11.2" data-path="more-resources.html"><a href="more-resources.html#general-r-programming"><i class="fa fa-check"></i><b>11.2</b> General R Programming</a></li>
<li class="chapter" data-level="11.3" data-path="more-resources.html"><a href="more-resources.html#r-projects-and-reproducibility"><i class="fa fa-check"></i><b>11.3</b> R Projects (and reproducibility)</a></li>
<li class="chapter" data-level="11.4" data-path="more-resources.html"><a href="more-resources.html#r-markdown-1"><i class="fa fa-check"></i><b>11.4</b> R Markdown</a></li>
<li class="chapter" data-level="11.5" data-path="more-resources.html"><a href="more-resources.html#wrangling-visualization"><i class="fa fa-check"></i><b>11.5</b> Wrangling &amp; Visualization</a></li>
<li class="chapter" data-level="11.6" data-path="more-resources.html"><a href="more-resources.html#reading-in-data-1"><i class="fa fa-check"></i><b>11.6</b> Reading in Data</a></li>
<li class="chapter" data-level="11.7" data-path="more-resources.html"><a href="more-resources.html#modeling-and-statistical-inference"><i class="fa fa-check"></i><b>11.7</b> Modeling and Statistical Inference</a></li>
<li class="chapter" data-level="11.8" data-path="more-resources.html"><a href="more-resources.html#gis-and-urban-planning"><i class="fa fa-check"></i><b>11.8</b> GIS and Urban Planning</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="miscellaneous-notes.html"><a href="miscellaneous-notes.html"><i class="fa fa-check"></i><b>12</b> Miscellaneous notes</a><ul>
<li class="chapter" data-level="12.1" data-path="miscellaneous-notes.html"><a href="miscellaneous-notes.html#where-to-get-help"><i class="fa fa-check"></i><b>12.1</b> Where to get help</a></li>
<li class="chapter" data-level="12.2" data-path="miscellaneous-notes.html"><a href="miscellaneous-notes.html#speed-versus-readability"><i class="fa fa-check"></i><b>12.2</b> Speed versus readability</a></li>
<li class="chapter" data-level="12.3" data-path="miscellaneous-notes.html"><a href="miscellaneous-notes.html#keyboard-shortcuts"><i class="fa fa-check"></i><b>12.3</b> Keyboard shortcuts</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">An Introduction to R at Met Council</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-wrangling" class="section level1">
<h1><span class="header-section-number">Section 8</span> Data Wrangling</h1>
<p>We will mostly be using the <code>tidyr</code> and <code>dplyr</code> packages for wrangling. With those packages, most wrangling is done with 6 “data verbs.” These are <code>select()</code>, <code>mutate()</code>, <code>filter()</code>, <code>arrange()</code>, <code>group_by()</code>, and <code>summarise()</code>. One quick note: summarise can be spelled the British or American way (as can any word with dual spellings). Much of the software was developed by people in New Zealand, hence the British spellings. I learned with British spellings so that’s what I use, but it works either way.</p>
<p><img src="https://raw.githubusercontent.com/allisonhorst/stats-illustrations/master/rstats-artwork/dplyr_wrangling.png" /><!-- --></p>
<p>We can divide our verbs into 3 categories: row verbs, column verbs, and aggregate verbs.</p>
<p>All of the verbs work in a similar way. The general structure is <code>verb(data, action)</code>.</p>
<div id="row-verbs" class="section level2">
<h2><span class="header-section-number">8.1</span> Row verbs</h2>
<p>The two row verbs are <code>filter()</code> and <code>arrange()</code>. Filter works by taking out rows that we don’t want in our data. Arrange works by ordering the rows in some way. We will talk about filter first.</p>
<div id="filter" class="section level3">
<h3><span class="header-section-number">8.1.1</span> Filter</h3>
<p>Filter takes in boolean statements and returns only the <code>TRUE</code> ones. For example, <code>&gt;</code>, <code>&lt;</code>, and <code>==</code> are boolean statements. The double equal is R’s way of saying something “is equivalent to.”</p>
<p>Let’s start by creating a dataframe of only Saturday trips.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create a new dataframe called weekend_trips</span>

saturday_trips &lt;-<span class="st"> </span><span class="kw">filter</span>(nice_ride_<span class="dv">2018</span>, start_day <span class="op">==</span><span class="st"> &quot;Sat&quot;</span>) 

<span class="kw">dim</span>(saturday_trips) <span class="co"># check that you have these dimensions</span></code></pre></div>
<pre><code>## [1] 66778    23</code></pre>
<p>We can also make a dataframe of trips that ended after 12 noon.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">after_<span class="dv">12</span> &lt;-<span class="st"> </span><span class="kw">filter</span>(nice_ride_<span class="dv">2018</span>, end_hour <span class="op">&gt;</span><span class="st"> </span><span class="dv">12</span>) 

<span class="kw">dim</span>(after_<span class="dv">12</span>)</code></pre></div>
<pre><code>## [1] 277163     23</code></pre>
<p>Let’s say we want some combination of filters. Maybe we want only the Saturday trips that ended after noon? We will use the <code>&amp;</code> operator in between filter actions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">saturday_after_<span class="dv">12</span> &lt;-<span class="st"> </span><span class="kw">filter</span>(nice_ride_<span class="dv">2018</span>, end_hour <span class="op">&gt;</span><span class="st"> </span><span class="dv">12</span> <span class="op">&amp;</span><span class="st"> </span>start_day <span class="op">==</span><span class="st"> &quot;Sat&quot;</span>)

<span class="kw">dim</span>(saturday_after_<span class="dv">12</span>)</code></pre></div>
<pre><code>## [1] 47806    23</code></pre>
<p>Now let’s make a dataframe of all the trips on a weekend day. We will use the <code>|</code> (or) operator in between filter actions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">weekend_trips &lt;-<span class="st"> </span><span class="kw">filter</span>(nice_ride_<span class="dv">2018</span>, start_day <span class="op">==</span><span class="st"> &quot;Sat&quot;</span> <span class="op">|</span><span class="st"> </span>start_day <span class="op">==</span><span class="st"> &quot;Sun&quot;</span>)

<span class="kw">dim</span>(weekend_trips)</code></pre></div>
<pre><code>## [1] 129776     23</code></pre>
<p>Let’s add Friday to that list.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">weekendFri_trips &lt;-<span class="st"> </span><span class="kw">filter</span>(nice_ride_<span class="dv">2018</span>, start_day <span class="op">==</span><span class="st"> &quot;Sat&quot;</span> <span class="op">|</span><span class="st"> </span>start_day <span class="op">==</span><span class="st"> &quot;Sun&quot;</span> <span class="op">|</span><span class="st"> </span>start_day <span class="op">==</span><span class="st"> &quot;Fri&quot;</span>)

<span class="kw">dim</span>(weekendFri_trips)</code></pre></div>
<pre><code>## [1] 190271     23</code></pre>
<p>It gets a little long to write that all out, and this is a pretty simply query. Luckily, R has an <code>%in%</code> operator to filter “in bulk.”</p>
<p>We would get the same results as above by writing:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">weekendFri_trips &lt;-<span class="st"> </span><span class="kw">filter</span>(nice_ride_<span class="dv">2018</span>, start_day <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Sat&quot;</span>, <span class="st">&quot;Sun&quot;</span>, <span class="st">&quot;Fri&quot;</span>))

<span class="kw">dim</span>(weekendFri_trips)</code></pre></div>
<pre><code>## [1] 190271     23</code></pre>
</div>
<div id="arrange" class="section level3">
<h3><span class="header-section-number">8.1.2</span> Arrange</h3>
<p>Arrange is a way to order your dataset by specific variables.</p>
<p>You can order by just one variable, like duration.</p>
</div>
</div>
<div id="practice-2" class="section level2">
<h2><span class="header-section-number">8.2</span> Practice</h2>
<ol style="list-style-type: decimal">
<li>How many trips were more than 30 minutes long? This is equivalent to 1800 seconds.</li>
</ol>
<p>2 (a). How many casual trips were there on Wednesdays, Thursdays, and Fridays?</p>
<p>2 (b) . How many casual trips were there on Wednesdays, Thursdays, and Fridays that were 15 minutes or less?</p>
<ol start="3" style="list-style-type: decimal">
<li>How many dockless trips taken by subscribed users were there total?</li>
</ol>
</div>
<div id="column-verbs" class="section level2">
<h2><span class="header-section-number">8.3</span> Column verbs</h2>
<p>Now that we’ve talked about wrangling the rows, we can think about wrangling the columns. <code>mutate</code> is used to create new columns, while <code>select</code> is used to narrow down the columns you keep in your table.</p>
<div id="mutate" class="section level3">
<h3><span class="header-section-number">8.3.1</span> Mutate</h3>
<p><img src="images/dplyr_mutate.png" width="2240" /></p>
<p>Let’s say we want to create a new duration variable that is in minutes instead of seconds. We can divide our old column by 60 to create the new column.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nice_ride_<span class="dv">2018</span> &lt;-<span class="st"> </span><span class="kw">mutate</span>(nice_ride_<span class="dv">2018</span>, <span class="dt">tripduration_min =</span> tripduration <span class="op">/</span><span class="st"> </span><span class="dv">60</span>)

<span class="kw">head</span>(nice_ride_<span class="dv">2018</span><span class="op">$</span>tripduration_min)</code></pre></div>
<pre><code>## [1] 22.883333 28.833333  9.116667 14.266667  7.583333 25.950000</code></pre>
</div>
</div>
<div id="practice-3" class="section level2">
<h2><span class="header-section-number">8.4</span> Practice</h2>
<p>The average trip duration in minutes is 21.257 (see code below).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(nice_ride_<span class="dv">2018</span><span class="op">$</span>tripduration_min)</code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   1.017   7.200  13.333  21.257  25.400 299.867</code></pre>
<p>Create a new variation called duration_deviation that calculates how far each trip was from the mean. Your resulting column should look something like this…</p>
<pre><code>## # A tibble: 6 x 1
##   duration_deviation
##                &lt;dbl&gt;
## 1               1.63
## 2               7.58
## 3             -12.1 
## 4              -6.99
## 5             -13.7 
## 6               4.69</code></pre>
<div id="select" class="section level3">
<h3><span class="header-section-number">8.4.1</span> Select</h3>
<p><img src="https://swcarpentry.github.io/r-novice-gapminder/fig/13-dplyr-fig1.png" /><!-- --></p>
</div>
</div>
<div id="aggregate-verbs" class="section level2">
<h2><span class="header-section-number">8.5</span> Aggregate verbs</h2>
<div id="section" class="section level3">
<h3><span class="header-section-number">8.5.1</span> <code>%&gt;%</code></h3>
<p>group_by and summarise are the two main verbs for aggregate statistics, they’re similar to Excel pivot tables. In this section we will also talk about the pipe, <code>%&gt;%</code>, operator. When doing data wrangling tasks there are often many intermediate tables. Maybe you filter, then create a new column, then calculate some summary statistic. Instead of doing all of these as discrete steps, we can link them to push the data through a workflow instead of stopping along the way. This makes life easier for you because you won’t clutter your environment or have to remember what <code>data3</code> has that <code>data4</code> doesn’t.</p>
<p>The way it works is fairly straightforward. You use the <code>%&gt;%</code> between data verbs and don’t input a new dataset. The operator is telling your verb to use the previously created data.</p>
<p>For example: if you wanted to filter out just Saturday trips and then convert the duration to minutes, you could do:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">saturday &lt;-<span class="st"> </span><span class="kw">filter</span>(nice_ride_<span class="dv">2018</span>, start_day <span class="op">==</span><span class="st"> &quot;Sat&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">duration_minutes =</span> tripduration <span class="op">/</span><span class="st"> </span><span class="dv">60</span>)</code></pre></div>
<p>Which gives you the exact same output as:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">saturday &lt;-<span class="st"> </span><span class="kw">filter</span>(nice_ride_<span class="dv">2018</span>, start_day <span class="op">==</span><span class="st"> &quot;Sat&quot;</span>)
saturday &lt;-<span class="st"> </span><span class="kw">mutate</span>(saturday, <span class="dt">duration_minutes =</span> tripduration <span class="op">/</span><span class="st"> </span><span class="dv">60</span>)</code></pre></div>
<p>With a lot less effort.</p>
</div>
<div id="group_by-summarise" class="section level3">
<h3><span class="header-section-number">8.5.2</span> group_by &amp; summarise</h3>
<p><code>group_by</code> is how we specify the base unit for aggregate summaries and <code>summarise</code> tells us what to calculate.</p>
<p>We can count the number of trips at each start station. Here we will group by the start station because we want counts <strong>per</strong> start station. Then to get a count summary we will use the <code>n()</code> function, which counts the number of observations or rows per group.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trips_per_station &lt;-<span class="st"> </span>nice_ride_<span class="dv">2018</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(start_station_name) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">trips =</span> <span class="kw">n</span>())

<span class="kw">head</span>(trips_per_station)</code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   start_station_name           trips
##   &lt;chr&gt;                        &lt;int&gt;
## 1 100 Main Street SE            7604
## 2 10th Street E &amp; Cedar Street   489
## 3 11th Ave S &amp; S 2nd Street     7901
## 4 11th Street &amp; Hennepin        2537
## 5 11th Street &amp; Marquette       2441
## 6 15th Ave SE &amp; Como Ave SE     2807</code></pre>
<p>We can also use functions like <code>sum()</code>, <code>mean()</code>, <code>min()</code>, <code>median()</code>, etc. For example, we can calculate the mean trip duration per start station.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mean_duration &lt;-<span class="st"> </span>nice_ride_<span class="dv">2018</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(start_station_name) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_duration =</span> <span class="kw">mean</span>(tripduration))

<span class="kw">head</span>(mean_duration)</code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   start_station_name           mean_duration
##   &lt;chr&gt;                                &lt;dbl&gt;
## 1 100 Main Street SE                   1534.
## 2 10th Street E &amp; Cedar Street          982.
## 3 11th Ave S &amp; S 2nd Street            1409.
## 4 11th Street &amp; Hennepin               1158.
## 5 11th Street &amp; Marquette              1675.
## 6 15th Ave SE &amp; Como Ave SE            1018.</code></pre>
<p>Then we could also chain a mutate to convert these times to minutes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mean_duration &lt;-<span class="st"> </span>nice_ride_<span class="dv">2018</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(start_station_name) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_duration =</span> <span class="kw">mean</span>(tripduration)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mean_duration_min =</span> mean_duration <span class="op">/</span><span class="st"> </span><span class="dv">60</span>)

<span class="kw">head</span>(mean_duration)</code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   start_station_name           mean_duration mean_duration_min
##   &lt;chr&gt;                                &lt;dbl&gt;             &lt;dbl&gt;
## 1 100 Main Street SE                   1534.              25.6
## 2 10th Street E &amp; Cedar Street          982.              16.4
## 3 11th Ave S &amp; S 2nd Street            1409.              23.5
## 4 11th Street &amp; Hennepin               1158.              19.3
## 5 11th Street &amp; Marquette              1675.              27.9
## 6 15th Ave SE &amp; Como Ave SE            1018.              17.0</code></pre>
</div>
</div>
<div id="practice-4" class="section level2">
<h2><span class="header-section-number">8.6</span> Practice</h2>
<ol style="list-style-type: decimal">
<li>Calculate the number of trips for each user type that occurred at each start station. The structure should look like the example below:</li>
</ol>
<p>Hint: you can use multiple grouping variables</p>
<pre><code>## # A tibble: 6 x 3
## # Groups:   start_station_name [3]
##   start_station_name           usertype   trips
##   &lt;chr&gt;                        &lt;chr&gt;      &lt;int&gt;
## 1 100 Main Street SE           Customer    6390
## 2 100 Main Street SE           Subscriber  1214
## 3 10th Street E &amp; Cedar Street Customer     188
## 4 10th Street E &amp; Cedar Street Subscriber   301
## 5 11th Ave S &amp; S 2nd Street    Customer    6312
## 6 11th Ave S &amp; S 2nd Street    Subscriber  1589</code></pre>
</div>
<div id="reshaping-verbs" class="section level2">
<h2><span class="header-section-number">8.7</span> Reshaping verbs</h2>
<div id="spread" class="section level3">
<h3><span class="header-section-number">8.7.1</span> Spread</h3>
<p><img src="https://garrettgman.github.io/images/tidy-8.png" /><!-- --></p>
</div>
<div id="gather" class="section level3">
<h3><span class="header-section-number">8.7.2</span> Gather</h3>
<p><img src="https://garrettgman.github.io/images/tidy-9.png" /><!-- --></p>
</div>
</div>
<div id="practice-5" class="section level2">
<h2><span class="header-section-number">8.8</span> Practice</h2>
</div>
<div id="joins" class="section level2">
<h2><span class="header-section-number">8.9</span> Joins</h2>
<p><code>dplyr</code> has two different families of joins. First, there’s “joining” joins, which is how we typically think of them</p>
<p><img src="images/joins1.png" width="304" /></p>
<p>Then there’s also filtering joins.</p>
<p><img src="images/join.png" width="276" /></p>
<p>These are useful when you want to filter the rows of one dataset based on another, but you don’t care about the attributes of that second dataset.</p>
<p>The general structure for joins is <code>join(x, y, c(&quot;common variable in x&quot; = &quot;common variable in y&quot;))</code>. We can join our trips data to the station locations which includes the total number of docks for each station.</p>
<p>First, load the station data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;station_locations&quot;</span>)

<span class="kw">head</span>(station_locations)</code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   number name                           latitude longitude total_docks
##   &lt;chr&gt;  &lt;chr&gt;                             &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;
## 1 30000  100 Main Street SE                 45.0     -93.3          27
## 2 30001  25th Street &amp; 33rd Ave S           45.0     -93.2          15
## 3 30002  Riverside Ave &amp; 23rd Ave S         45.0     -93.2          15
## 4 30003  Plymouth Ave N &amp;  N Oliver Ave     45.0     -93.3          15
## 5 30004  11th Street &amp; Hennepin             45.0     -93.3          23
## 6 30005  Hennepin &amp; Central Avenue NE       45.0     -93.3          15</code></pre>
<p>So then if we want to join these by the <code>start_station_name</code> variable in our trips dataset, we would type:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">joined &lt;-<span class="st"> </span><span class="kw">left_join</span>(nice_ride_<span class="dv">2018</span>, station_locations, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;start_station_name&quot;</span> =<span class="st"> &quot;name&quot;</span>))

<span class="kw">glimpse</span>(joined)</code></pre></div>
<pre><code>## Observations: 409,002
## Variables: 27
## $ tripduration            &lt;dbl&gt; 1373, 1730, 547, 856, 455, 1557, 2001,...
## $ start_datetime          &lt;dttm&gt; 2018-04-24 16:03:04, 2018-04-24 16:38...
## $ end_datetime            &lt;dttm&gt; 2018-04-24 16:25:57, 2018-04-24 17:07...
## $ start_station_id        &lt;dbl&gt; 170, 2, 13, 94, 13, 43, 167, 157, 153,...
## $ start_station_name      &lt;chr&gt; &quot;Boom Island Park&quot;, &quot;100 Main Street S...
## $ start_station_latitude  &lt;dbl&gt; 44.99254, 44.98489, 44.98609, 44.97821...
## $ start_station_longitude &lt;dbl&gt; -93.27026, -93.25655, -93.27246, -93.2...
## $ end_station_id          &lt;dbl&gt; 2, 13, 94, 13, 43, 167, 157, 153, 201,...
## $ end_station_name        &lt;chr&gt; &quot;100 Main Street SE&quot;, &quot;North 2nd Stree...
## $ end_station_latitude    &lt;dbl&gt; 44.98489, 44.98609, 44.97821, 44.98609...
## $ end_station_longitude   &lt;dbl&gt; -93.25655, -93.27246, -93.26023, -93.2...
## $ bikeid                  &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,...
## $ usertype                &lt;chr&gt; &quot;Customer&quot;, &quot;Customer&quot;, &quot;Subscriber&quot;, ...
## $ birth_year              &lt;dbl&gt; 1969, 1969, 1985, 1985, 1988, 1969, 19...
## $ gender                  &lt;dbl&gt; 0, 0, 2, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0,...
## $ bike_type               &lt;chr&gt; &quot;Classic&quot;, &quot;Classic&quot;, &quot;Classic&quot;, &quot;Clas...
## $ start_month             &lt;dbl&gt; 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4,...
## $ start_day               &lt;ord&gt; Tue, Tue, Tue, Tue, Wed, Fri, Fri, Fri...
## $ end_month               &lt;dbl&gt; 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4,...
## $ end_day                 &lt;ord&gt; Tue, Tue, Tue, Tue, Wed, Fri, Fri, Fri...
## $ start_hour              &lt;int&gt; 16, 16, 17, 18, 8, 11, 12, 13, 14, 13,...
## $ end_hour                &lt;int&gt; 16, 17, 18, 19, 8, 12, 12, 13, 15, 14,...
## $ tripduration_min        &lt;dbl&gt; 22.883333, 28.833333, 9.116667, 14.266...
## $ number                  &lt;chr&gt; &quot;30151&quot;, &quot;30000&quot;, &quot;30011&quot;, &quot;30090&quot;, &quot;3...
## $ latitude                &lt;dbl&gt; 44.99254, 44.98489, 44.98609, 44.97807...
## $ longitude               &lt;dbl&gt; -93.27026, -93.25655, -93.27246, -93.2...
## $ total_docks             &lt;dbl&gt; 15, 27, 19, 19, 19, NA, 23, 15, 27, 15...</code></pre>
<p>We can see at the end that there’s now a total_docks variable.</p>
</div>
<div id="practice-6" class="section level2">
<h2><span class="header-section-number">8.10</span> Practice</h2>
<ul>
<li>Join the trips and stations on the end_station_name variable</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="visualization.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="visualization-revisited.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["met-council-introR.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
